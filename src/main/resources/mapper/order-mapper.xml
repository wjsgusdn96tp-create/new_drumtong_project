<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.iei.order.dao.OrderDao">
	
	<select id="shopList" resultType="shop">
		select * from shop_tbl
	</select>
	
	
	<select id="getShop" resultType="shop">
	  select * from shop_tbl
	  where shop_name = #{shopName}
	</select>
	
	<!-- 자명님 물건값 받아오는 로직  -->
	<select id="option" resultType="product">
		select product_title, product_no, product_img,product_name,product_price from product_tbl where product_no = #{productNo}
	</select>
	

	<insert id="insertCart">
		insert into cart_item_tbl (cart_no, cup_choice, cup_size, cup_shot, cup_cream, count, product_no, 
			member_no, shop_name, pay, product_name, product_title)
			values (cart_item_tbl_seq.nextval,
			#{cupChoice}, 
			#{cupSize}, 
			#{cupShot}, 
			#{cupCream},
			#{count}, 
			#{productNo}, 
			#{memberNo}, 
			#{shopName}, 
			#{pay},
			#{productName},
			#{productTitle})
	</insert>
	
	<select id="selectCartList" resultType="cart">
		select * from cart_item_tbl where member_no = #{memberNo} and shop_name = #{shopName}
	</select>
	
		
	<insert id="insertOrderTbl">
		insert into order_tbl values(#{orderNo},#{memberNo},#{shopName},to_char(sysdate,'yyyy-mm-dd'))
	</insert>
	 
	 <select id="getorderNo" resultType="int">
		select order_tbl_seq.nextval from dual
	 </select>
	 
	 <insert id="insertDetailsTbl">
	 	insert into order_details_tbl values(order_details_tbl_seq.nextval,
	 	#{cupChoice},
	 	#{cupSize},
	 	#{cupShot},
	 	#{cupCream},
	 	#{heat},
	 	#{count},
	 	#{productNo},
	 	#{orderNo},
	 	#{pay},
	 	#{discountName},
	 	#{discountPrice},
	 	to_char(sysdate,'yyyy-mm-dd'),
	 	#{productName},
	 	#{shopName},
	 	#{productTitle}
	 	
	 	)
	 </insert>
	 
	 <delete id="deleteCart">
	 	delete from cart_item_tbl where member_no = #{memberNo} and shop_name = #{shopName}
	 </delete>
	 	
	<select id="selectOrderPay" resultType="chart">
		select substr(enroll_date,1,4) as year , sum(pay) as sum_pay from order_details_tbl group by substr(enroll_date,1,4)
	</select>
	
	<select id="selectOrderCount" resultType="chart">
		select substr(enroll_date,1,4) as year , sum(count) as sum_count from order_details_tbl group by substr(enroll_date,1,4)
	</select>
	
	<select id="selectOrderShop" resultType="chart">
		select shop_name, sum(pay) as sum_pay, sum(count) as sum_count from order_details_tbl join shop_tbl using(shop_name) group by shop_name
	</select>
	
		<delete id="cartdel">
			delete from cart_item_tbl where cart_no = #{cartNo}
		</delete>
	<select id="selectOrderList" resultType="order">
		select * from order_tbl where member_no = #{memberNo}
	</select>
	<select id="selectDetailList" resultType="details" >
		select * from order_details_tbl where order_no = #{orderNo}
	</select>
	
	
		
		
</mapper>
