<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.iei.order.dao.OrderDao">
	
	<select id="shopList" resultType="shop">
		select * from shop_tbl
	</select>
	
	
	<select id="getShop" resultType="shop">
	  select * from shop_tbl
	  where shop_name = #{shopName}
	</select>
	
	<!-- 자명님 물건값 받아오는 로직  -->
	<select id="option" resultType="product">
		select product_no, product_img,product_name,product_price from product_tbl where product_no = #{productNo}
	</select>
	

	<insert id="insertCart">
		insert into cart_item_tbl (cart_no, cup_choice, cup_size, cup_shot, cup_cream, count, product_no, 
			member_no, shop_name, pay, product_name)
			values (cart_item_tbl_seq.nextval,
			#{cupChoice}, 
			#{cupSize}, 
			#{cupShot}, 
			#{cupCream},
			#{count}, 
			#{productNo}, 
			#{memberNo}, 
			#{shopName}, 
			#{pay},
			#{productName})
	</insert>
	
	<select id="selectCartList" resultType="cart">
		select * from cart_item_tbl where member_no = #{memberNo} and shop_name = #{shopName}
	</select>
	
		
	<insert id="insertOrderTbl">
		insert into order_tbl values(#{orderNo},#{memberNo},#{shopName},to_char(sysdate,'yyyy-mm-dd'))
	</insert>
	 
	 <select id="getorderNo" resultType="int">
		select order_tbl_seq.nextval from dual
	 </select>
	 
	 <insert id="insertDetailsTbl">
	 	insert into order_details_tbl values(order_details_tbl_seq.nextval,
	 	#{cupChoice},
	 	#{cupSize},
	 	#{cupShot},
	 	#{cupCream},
	 	#{heat},
	 	#{count},
	 	#{productNo},
	 	#{orderNo},
	 	#{pay},
	 	#{discountName},
	 	#{discountPrice},
	 	to_char(sysdate,'yyyy-mm-dd'),
	 	#{productName},
	 	#{shopName}
	 	
	 	)
	 </insert>
	 
	 <delete id="deleteCart">
	 	delete from cart_item_tbl where member_no = #{memberNo} and shop_name = #{shopName}
	 </delete>
	 	
	<select id="selectOrderPay" resultType="int">
		select sum(pay) from order_details_tbl group by substr(enroll_date,1,4) having substr(enroll_date,1,4) = to_char(add_months(sysdate, #{year}), 'yyyy')
	</select>
	
	<select id="selectOrderCount" resultType="int">
		select sum(count) from order_details_tbl group by substr(enroll_date,1,4) having substr(enroll_date,1,4) = to_char(add_months(sysdate, ((-12)*0)), 'yyyy')
	</select>
</mapper>
