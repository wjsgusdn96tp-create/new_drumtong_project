<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="/DrumtongJs/news.js"></script>
<link rel="stylesheet" href="/DrumtongCss/news.css">
<style>
	.item-img-div{
		overflow: hidden;
	}
	.text-warp{
		margin-top: 10px;
	}
	.news-list{
		overflow: hidden;
	}
</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<div class="content-wrap">
	
		<div id="main-news">
			<img src="/img/news/main_promotion3.jpg" class="main-news3">
			<div class="btn-div">
				<a href="/" class="btn write-btn" style="float:right;">이미지 수정</a>	<!-- 관리자만 노출 -->
			</div>
		</div>
		<div class="tab">
			<ul class="first-tab">
				<li>전체보기</li>
				<li>이벤트</li>
				<li>프로모션</li>
			</ul>
			<span></span>
			<ul  class="second-tab">
				<li>공지사항</li>
			</ul>
		</div>
		
		<div class="btn-div">
			<a href="/news/noticeWriteFrm" class="btn write-btn">공지사항 쓰기</a>	
			<a href="/news/writeFrm" class="btn write-btn">NEWS 쓰기</a>	
		</div>
		
		<div class="list">
			<ul class="news-list"> 
			
			
			</ul>
			<div id="add-search"> 		
				<button class="btn" id="more-btn">더보기</button>
			</div>
		</div>	
		
		
		
		<div class="notice_wrap close">
			<div class="notice-list">
				<table border=1>
					<tr>
						<th style="width:10%">번호</th>
						<th style="width:50%">글 제목</th>
						<th style="width:15%">작성일</th>
						<th style="width:10%">조회수</th>
						<th>수정</th> <!-- 관리자만 노출 -->
						<th>삭제</th> <!-- 관리자만 노출 -->
						
					</tr>
					<tr th:each="notice : ${notice}">
						<td th:text="${notice.noticeNo}"></td>
						<td> <a th:href="@{/news/noticeView(noticeNo=${notice.noticeNo})}" th:text="${notice.title}"></a></td>
						<td th:text="${notice.writeDate}"></td>
						<td>999</td>
						<td><button>수정</button></td> <!-- 관리자만 노출 -->
						<td><button>삭제</button></td> <!-- 관리자만 노출 -->
					</tr>
				</table>
			</div>
			<div class= page-item id="pageNavi" th:utext="${pageNavi}"></div>
		</div>
	</div>
	<th:block th:include="common/footer"></th:block>
	
	<script th:inline="javascript">
		const totalCount = [[${totalCount}]]; 	// news 게시물 갯수
		let currentCount = 0;					// 현재까지 읽어온 게시물 수
		let start = 1;							// 게시물의 시작 번호
		const amount = 6;						// 더보기 한번 클릭 시 추가로 가져올 게시물 수 
		

		
		$("#more-btn").on("click",function() {
			$.ajax({
				url: "/news/more",
				type: "get",
				data: {start: start, amount : amount},
				success : function(newsList){
					for(let i=0; i<newsList.length ; i++){
						const n = newsList[i];
						
						/* -> 최종 모양
								<li class="news-item"> 
									<div class="item-img-div">
										<img src="/img/프로모션1.jpg">
									</div>
									<div class="text-warp">
										<div class="news-title">
											<span class="type">[프로모션]</span> 
											<span>DRUMTONG 텀블러 출시! 아주아주 긴 제목으로 씁니다. 길면 축약</span> 
										</div>
										<div class="list-small">
											<span class=date>
												<span>2025-08-26</span>
												<span>~</span>
												<span>2025-09-01</span>
											</span>
											<span class=like>
												<span>99</span>
												<span class="material-icons">favorite_border</span>
											</span>
										</div>
										<div>
											<button class="discountBtn">할인 적용하기</button>
											<button class="close discountUpdate">할인 수정하기</button>
										</div>
									</div>
								</li>
						*/
						
						const li = $("<li>");
						li.addClass("news-item");
						
						
						
						const imgDiv = $("<div>");
						imgDiv.addClass("item-img-div");
						const img = $("<img>");
						img.attr("src", "/news/image/"+n.image);
						// <img src="에서 조회해온 이미지path">
						imgDiv.append(img);
												
						const textWrap = $("<div>");
						textWrap.addClass("text-warp");
						const titleDiv = $("<div>");
						titleDiv.addClass("news-title");
						const typeSpan = $("<span>");
						typeSpan.addClass("type");
						typeSpan.text("["+n.type+"] ");
						const titleSpan = $("<span>");
						titleSpan.text(n.title);
						titleDiv.append(typeSpan).append(titleSpan);
						
						const smallDiv = $("<div>");
						smallDiv.addClass("list-small");
						
						const dateSpan = $("<span>");
						dateSpan.addClass("date");
						const startDateSpan = $("<span>");
						startDateSpan.text(n.startDate);
						const middleDateSpan = $("<span>");
						middleDateSpan.text(" ~ ");
						const endDateSpan = $("<span>");
						endDateSpan.text(n.endDate);
						dateSpan.append(startDateSpan).append(middleDateSpan).append(endDateSpan);
						
						const likeSpan = $("<span>");
						likeSpan.addClass("like");
						const likeCountSpan = $("<span>");
						likeCountSpan.text(n.likeCount);
						
						const likeIconSpan = $("<span>");
						likeIconSpan.addClass("material-icons").addClass("likeBtn").text("favorite_border");
						likeIconSpan.addClass("material-icons").addClass("likeBtn").text("favorite");
						const newsNo = $("<span>");
						newsNo.text(n.newsNo).addClass("close");
						likeSpan.append(likeIconSpan).append(newsNo).append(likeCountSpan);
						smallDiv.append(dateSpan).append(likeSpan);
						
						const discountDiv = $("<div>");
						const discountBtn = $("<a>");
						discountBtn.addClass("discountBtn").addClass("btn");
						discountBtn.text("할인 적용하기");
						discountBtn.attr("href","/news/discountWriteFrm?title="+n.title+"&newsNo="+n.newsNo);
						const discountUpdate = $("<a>");
						discountUpdate.addClass("discountUpdate").addClass("btn");
						discountUpdate.text("할인 수정하기");
						discountDiv.append(discountBtn).append(discountUpdate);
						
						
						textWrap.append(titleDiv).append(smallDiv).append(discountDiv);
						
						li.append(imgDiv).append(textWrap);
												
												
						$(".news-list").append(li);
						
						
					}
					
					start += amount; 
					currentCount += newsList.length;  
					if(currentCount === totalCount) {
						$("#more-btn").remove();
					}
				},
				error : function(){
					console.log("에러");
				}
			})
		});
		
		
		$(document).on("click",".likeBtn",function(){
			const currentText = $(this).text();
			const isLike = (currentText === "favorite")?1:0;
			const newsNo =$(this).next().text();

			$.ajax({
				url : "/news/likepush",
				data : {newsNo : newsNo, isLike : isLike},
				type : "post",
				success : function(data){
					if(isLike === 0) {
						$(this).text("favorite");
					} else {
						$(this).text("favorite_border");						
					}
					$(this).next().text(data);
				}
			})
			
		});
	

	$(".second-tab>li").on("click", function(){
		$(".notice_wrap").removeClass("close");
		$(".news-list").addClass("close");
	});
		
	</script>
</body>
</html>