<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>옵션선택</title>
    <link rel="stylesheet" href="/DrumtongCss/default.css">
    <link rel="stylesheet" href="/DrumtongCss/orderoption.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    
</head>
<body>
    <th:block th:include="/common/header"></th:block>
    <div>
   	로그인 회원 번호: <span th:text="${memberNo}"></span>
	</div>
	<div>
    shopName 값: <span th:text="${shopName}"></span>
	</div>
	<div>
    productNo 값: <span th:text="${p.productNo}"></span>
	</div>
    
    <div class="order-option-header">옵션선택</div>

	<div class="order-option-main-box">
	    <div class="order-option-image-box"><img src="/" ></div>
	
	    <div class="order-option-option-box">
	    
	        <div class="order-option-top">
	            <div class="order-option-name" th:text=${p.productName}></div>
	        </div>
	
	            <div class="order-option-quantity-box">
	                <div class="order-option-quantity">
	                    <button class="button-minus1"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-count">1</span>
	                    <button class="button-plus1"><span class="material-icons">add_circle_outline</span></button>
	                </div>
	                <div class="order-option-price" th:text=${p.productPrice}></div>
	                	                <div>원</div>
	            </div>
	            
	    <div class="order-option-section">
	        <div class="order-option-label">컵 선택</div>
	            <div class="order-option-cupchoice">
	                <button class="order-option-cupbtn selected">개인</button>
	                <button class="order-option-cupbtn">매장</button>
	            </div>
	    </div>
	 
	    <div class="order-option-section">
	        <div class="order-option-label">사이즈 선택 (기본 L, XL + 2000원)</div>
	            <div class="order-option-sizechoice">
	                <button class="order-option-sizebtn selected" >L</button>
	                <button class="order-option-sizebtn" >XL</button>
	            </div>
	    </div>
	
	    <div class="order-option-section">
	        <div class="order-option-label">샷 추가 (+400원, 최대3회)</div>
	            <div class="order-option-choice">
	                <button class="button-minus2"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-shotcount">0</span>
	                <button class="button-plus2"><span class="material-icons">add_circle_outline</span></button>
	            </div>
	    </div>
	    
	    <div class="order-option-section">
	        <div class="order-option-label">휘핑크림 추가(+500원, 최대2회)</div>
	            <div class="order-option-choice">
	                <button class="button-minus3"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-creamcount" >0</span>
	                <button class="button-plus3"><span class="material-icons">add_circle_outline</span></button>
	           	</div>
	    </div>
	
	        <div class="order-option-totalbox">
	            <div class="order-option-totalname">결제금액</div>
	            <div class="order-option-totalprice" th:text=${p.productPrice}></div>
	                <div>원</div>
	        </div>
	    </div>
	</div>



	<div class="order-option-footer">
	    <a href="/product/productList?reqPage=1" class="order-listpage">메뉴목록</a>
	    
	    <!--
	    나중에 매장 이름으로 불러올때 새로고침 하는 경우의 값
	    <a href="/product/productList?reqPage=${reqPage}&shopName=${shopName}" class="order-listpage">
	      -->
	    
	     <form id="cartForm" action="/order/DrumtongCart" method="post">
		      <input type="hidden" name="productNo" th:value="${p.productNo}">
		      <input type="hidden" name="productName" th:value="${p.productName}">
		      <input type="hidden" name="productPrice" th:value="${p.productPrice}">
		      <input type="hidden" name="shopName" th:value="${shopName}">
		 <!-- 이미지 받을것 <input type="hidden" name="productImg" th:value="${p.productImg}"> -->   
		      <input type="hidden" name="count" id="countInput" th:value="1">
		      <input type="hidden" name="cupShot" id="shotInput" th:value="0">
		      <input type="hidden" name="cupCream" id="creamInput" th:value="0">
		      <input type="hidden" name="cupChoice" id="cupInput" th:value="개인">
		      <input type="hidden" name="cupSize" id="sizeInput" th:value="L">
		      <input type="hidden" name="pay" id="payInput" th:value="${p.productPrice}">
	   
	    <button type="submit" class="order-cartadd">장바구니담기</button>
	    </form>
	    
	    
	    <form action="/order/Orderoption" method="get">
	    	<input type="hidden" th:value="${p.productNo}" name="productNo">
	    	<button type="submit" class="order-reset">옵션초기화</button>
	    </form>
	    
	</div>
	
<script th:inline="javascript">
	const shotPay =  400;
	const creamPay = 500;
	const optionPrice = Number($(".order-option-price").text());
	const sizePrice = 2000;
	$("#payInput").val(optionPrice);
	
	$(".order-option-sizebtn").on("click",function(){
		
		const shop = $(this).text();	
		console.log(shop);
		$(".order-option-sizebtn").removeClass("selected");	
		$(this).addClass("selected");
		
		const optionCount = $(".order-option-count").text();
		const shotCount = $(".order-option-shotcount").text();
		const creamCount = $(".order-option-creamcount").text();
		let plusCount = 0;
		
		if(shop=="XL") {
			plusCount = 1;
		} 
			// 마지막 결제 금액
	        // const newtotalPay = $(".order-option-totalprice").text();
			//태그 안의 텍스트 값을 숫자로 변형
			
		const sizeTotal = sizePrice * plusCount;
		const totalPrice = optionPrice * optionCount
		const shotTotal = shotCount * shotPay;
		const creamTotal = creamCount * creamPay;
					
		const payPrice = totalPrice + shotTotal + creamTotal + sizeTotal;
					
			//태그 안의 문자열값에 플러스한 값을 대입
			$(".order-option-price").text(totalPrice);
			$(".order-option-totalprice").text(payPrice);
		
			
			//인풋값 밸류 변경 밸류값을 대입

			 $("#sizeInput").val(shop);    // "L" or "XL" 값
  			 $("#payInput").val(payPrice);    // 결제금액
	
	});
	
	$(".order-option-cupbtn").on("click",function(){
		const solo = $(this).text();

		$(".order-option-cupbtn").removeClass("selected");	
		
		$(this).addClass("selected");
		
		$("#cupInput").val(solo);
	
	});
	
	//지정한 클래스명을 눌렀을때 동작		
	$(".button-plus1").on("click",function(){
		//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
		const optionCount = $(".order-option-count").text();
		const shotCount = $(".order-option-shotcount").text();
		const creamCount = $(".order-option-creamcount").text();
		
		// 마지막 결제 금액
        // const newtotalPay = $(".order-option-totalprice").text();
		//태그 안의 텍스트 값을 숫자로 변형
		const plusCount = Number(optionCount)+1;
		
		if(optionCount == 10){
			return;
		}
		
		const totalPrice = optionPrice * plusCount;
		const shotTotal = shotCount * shotPay;
		const creamTotal = creamCount * creamPay;
				
		const payPrice = totalPrice+shotTotal+creamTotal;
				
		//태그 안의 문자열값에 플러스한 값을 대입
		$(".order-option-count").text(plusCount);
		$(".order-option-price").text(totalPrice);
		$(".order-option-totalprice").text(payPrice);
		
		$("#countInput").val(plusCount);
		$("#payInput").val(payPrice);
	});
	
	$(".button-plus2").on("click", function(){
		//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
		const optionCount = $(".order-option-count").text();
		const shotCount = $(".order-option-shotcount").text();
		const creamCount = $(".order-option-creamcount").text();
		
		
		// 마지막 결제 금액
        // const newtotalPay = $(".order-option-totalprice").text();
		//태그 안의 텍스트 값을 숫자로 변형
		const plusCount = Number(shotCount)+1;
		
		if(shotCount == 3){
			return;
		}
		
		const totalPrice = optionPrice * optionCount;
		const shotTotal = plusCount * shotPay;
		const creamTotal = creamCount * creamPay;
				
		const payPrice = totalPrice+shotTotal+creamTotal;
				
		//태그 안의 문자열값에 플러스한 값을 대입
		$(".order-option-shotcount").text(plusCount);
		$(".order-option-price").text(totalPrice);
		$(".order-option-totalprice").text(payPrice);
		
		$("#shotInput").val(plusCount);
		$("#payInput").val(payPrice);
		
	});
	
	$(".button-plus3").on("click",function(){
		//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
		const optionCount = $(".order-option-count").text();
		const shotCount = $(".order-option-shotcount").text();
		const creamCount = $(".order-option-creamcount").text();
		
		const plusCount = Number(creamCount)+1;
		
		if(creamCount == 2){
			return;	
		}
	
		const totalPrice = optionPrice *optionCount;
		const shotTotal = shotCount * shotPay;
		const creamTotal = plusCount * creamPay;
				
		const payPrice = totalPrice + shotTotal + creamTotal;
				
		//태그 안의 문자열값에 플러스한 값을 대입
		$(".order-option-creamcount").text(plusCount);
		$(".order-option-price").text(totalPrice);
		$(".order-option-totalprice").text(payPrice);
			
		$("#creamInput").val(plusCount);
		$("#payInput").val(payPrice);
		
	});
		
		
	$(".button-minus1").on("click",function(){
		const optionCount = $(".order-option-count").text();
		const shotCount = $(".order-option-shotcount").text();
		const creamCount = $(".order-option-creamcount").text();
		
		const minusCount = Number(optionCount)-1;
		
		if(optionCount == 1 ){
			return;
		}
		
		
		const totalPrice = optionPrice * minusCount;
		const shotTotal = shotCount * shotPay;
		const creamTotal = creamCount * creamPay;
				
		const payPrice = totalPrice+shotTotal+creamTotal;
				
		$(".order-option-count").text(minusCount);
		$(".order-option-price").text(totalPrice);
		$(".order-option-totalprice").text(payPrice);
		
		$("#countInput").val(minusCount);
		$("#payInput").val(payPrice);
	});
			

	
	$(".button-minus2").on("click", function(){
		//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
		const optionCount = $(".order-option-count").text();
		const shotCount = $(".order-option-shotcount").text();
		const creamCount = $(".order-option-creamcount").text();
		
		
		// 마지막 결제 금액
        // const newtotalPay = $(".order-option-totalprice").text();
		//태그 안의 텍스트 값을 숫자로 변형
		const minusCount = Number(shotCount)-1;
		
		if(shotCount == 0){
			return;
		}
		
		const totalPrice = optionPrice * optionCount;
		const shotTotal = minusCount * shotPay;
		const creamTotal = creamCount * creamPay;
				
		const payPrice = totalPrice+shotTotal+creamTotal;
				
		//태그 안의 문자열값에 플러스한 값을 대입
		$(".order-option-shotcount").text(minusCount);
		$(".order-option-price").text(totalPrice);
		$(".order-option-totalprice").text(payPrice);
		
		$("#shotInput").val(minusCount);
		$("#payInput").val(payPrice);
	});
		
		
	$(".button-minus3").on("click",function(){
		//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
		const optionCount = $(".order-option-count").text();
		const shotCount = $(".order-option-shotcount").text();
		const creamCount = $(".order-option-creamcount").text();
		
		const minusCount = Number(creamCount)-1;
		
		if(creamCount == 0){
			return;	
		}
	
		const totalPrice = optionPrice *optionCount;
		const shotTotal = shotCount * shotPay;
		const creamTotal = minusCount * creamPay;
				
		const payPrice = totalPrice + shotTotal + creamTotal;
				
		//태그 안의 문자열값에 플러스한 값을 대입
		$(".order-option-creamcount").text(minusCount);
		$(".order-option-price").text(totalPrice);
		$(".order-option-totalprice").text(payPrice);
		
		$("#creamInput").val(minusCount);
		$("#payInput").val(payPrice);
		
	});
	
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
</script>
</body>
</html>