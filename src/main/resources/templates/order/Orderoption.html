<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>옵션선택</title>
    <link rel="stylesheet" href="/DrumtongCss/default.css">
    <link rel="stylesheet" href="/DrumtongCss/orderoption.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    
</head>
<body>
    <th:block th:include="/common/header"></th:block>
    <div>
   	로그인 회원 번호: <span th:text="${memberNo}"></span>
	</div>
	<div>
    shopName 값: <span th:text="${shop.shopName}"></span>
	</div>
	<div>
    productNo 값: <span th:text="${p.productNo}"></span>
	</div>
    
    <div class="order-option-header">옵션선택</div>

	<div class="order-option-main-box">
	    <div class="order-option-image-box"><img src="/" ></div>
	
	    <div class="order-option-option-box">
	    
	        <div class="order-option-top">
	            <div class="order-option-name" th:text="${p.productName}"></div>
	        </div>
	
	            <div class="order-option-quantity-box">
	                <div class="order-option-quantity">
	                    <button class="button-minus1"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-count">1</span>
	                    <button class="button-plus1"><span class="material-icons">add_circle_outline</span></button>
	                </div>
	                <div class="order-base-price" th:text="${p.productPrice}"></div>
	                	                <div>원</div>
	            </div>
	            
	    <div class="order-option-section">
	        <div class="order-option-label">컵 선택</div>
	            <div class="order-option-cupchoice">
	                <button class="order-option-cupbtn selected">개인</button>
	                <button class="order-option-cupbtn">매장</button>
	            </div>
	    </div>
	 
	    <div class="order-option-section">
	        <div class="order-option-label">사이즈 선택 (기본 L, XL + 2000원)</div>
	            <div class="order-option-sizechoice">
	                <button class="order-option-sizebtn selected" >L</button>
	                <button class="order-option-sizebtn" >XL</button>
	            </div>
	    </div>
	
	    <div class="order-option-section">
	        <div class="order-option-label">샷 추가 (+400원, 최대3회)</div>
	            <div class="order-option-choice">
	                <button class="button-minus2"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-shotcount">0</span>
	                <button class="button-plus2"><span class="material-icons">add_circle_outline</span></button>
	            </div>
	    </div>
	    
	    <div class="order-option-section">
	        <div class="order-option-label">휘핑크림 추가(+500원, 최대2회)</div>
	            <div class="order-option-choice">
	                <button class="button-minus3"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-creamcount" >0</span>
	                <button class="button-plus3"><span class="material-icons">add_circle_outline</span></button>
	           	</div>
	    </div>
	
	        <div class="order-option-totalbox">
	            <div class="order-option-totalname">결제금액</div>
	            <div class="order-option-totalprice" th:text="${p.productPrice}"></div>
	                <div>원</div>
	        </div>
	    </div>
	</div>



	<div class="order-option-footer">
	    <a href="/product/productList?reqPage=1" class="order-listpage">메뉴목록</a>
	    <!--
	    나중에 매장 이름으로 불러올때 새로고침 하는 경우의 값
	    <a href="/product/productList?reqPage=${reqPage}&shopName=${shopName}" class="order-listpage">
	      -->
	    
		
		
		      <input type="hidden" name="productNo" id="productNo" th:value="${p.productNo}">
			  <input type="hidden" name="productName" id="productName" th:value="${p.productName}">
			  <input type="hidden" name="productPrice" id="productPrice" th:value="${p.productPrice}">
			  <input type="hidden" name="shopName" id="shopName" th:value="${shop.shopName}">
			  <!-- 이미지 받을것 <input type="hidden" name="productImg" id="productImg" th:value="${p.productImg}">-->
		      <input type="hidden" name="count" id="count" th:value="1">
		      <input type="hidden" name="cupShot" id="cupShot" th:value="0">
		      <input type="hidden" name="cupCream" id="cupCream" th:value="0">
		      <input type="hidden" name="cupChoice" id="cupChoice" th:value="개인">
		      <input type="hidden" name="cupSize" id="cupSize" th:value="L">
		      <input type="hidden" name="pay" id="pay" th:value="${p.productPrice}">
	   
	    <button type="submit" class="order-cartadd">장바구니담기</button>

	    
	    
	    <form action="/order/DrumtongCart" method="get">
	    	<input type="hidden" name="productNo" id="productNo" th:value="${p.productNo}">
	    	<input type="hidden" name="shopName" id="shopName" th:value="${shop.shopName}">
	    	<button type="submit" class="order-moveCart">장바구니가기</button>
	    </form>
	</div>
	
<script th:inline="javascript">
			const shotPay =  400;
			const creamPay = 500;
			const sizePrice = 2000;
			let selectedSize = "L";
			
			const basePrice = Number($(".order-base-price").text());
			
			$("#pay").val(basePrice); 
			
			
			
			$(".order-option-sizebtn").on("click",function(){
			
				
				const optionCount = $(".order-option-count").text();
				const shotCount = $(".order-option-shotcount").text();
				const creamCount = $(".order-option-creamcount").text();
				
				const shop = $(this).text();	
				
				console.log(shop);
			
				$(".order-option-sizebtn").removeClass("selected");	
				$(this).addClass("selected");
				
				selectedSize = shop;
				
				let plusCount = 0;
				
				if(selectedSize=="XL") {
					plusCount = 1;
				} 
					
					
				const totalPrice = basePrice * optionCount;
				const sizeTotal = sizePrice * plusCount * optionCount;
				const shotTotal = shotCount * shotPay * optionCount;
				const creamTotal = creamCount * creamPay * optionCount;
			
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
				
					//태그 안의 문자열값에 플러스한 값을 대입
					$(".order-option-price").text(totalPrice);
					$(".order-option-totalprice").text(payPrice);
				
					
					//인풋값 밸류 변경 밸류값을 대입
			
					 $("#cupSize").val(shop);    // "L" or "XL" 값
						 $("#pay").val(payPrice);    // 결제금액
			
			});
			
			$(".order-option-cupbtn").on("click",function(){
				const solo = $(this).text();
				
				$(".order-option-cupbtn").removeClass("selected");	
				
				$(this).addClass("selected");
				
				$("#cupChoice").val(solo);
			
			});
			
			//지정한 클래스명을 눌렀을때 동작		
			$(".button-plus1").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $(".order-option-count").text();
				const shotCount = $(".order-option-shotcount").text();
				const creamCount = $(".order-option-creamcount").text();
				
			
				const plusCount = Number(optionCount)+1;
				
				if(optionCount == 10){
					return;
				}
				
				let sizeCount = 0;
				
				if(selectedSize == "XL") {
					sizeCount = 1;
				}
				
				const totalPrice = basePrice * plusCount;
				const sizeTotal = sizePrice * sizeCount * plusCount;
				const shotTotal = shotCount * shotPay * plusCount;
				const creamTotal = creamCount * creamPay * plusCount;
						
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$(".order-option-count").text(plusCount);
				$(".order-base-price").text(totalPrice);
				$(".order-option-totalprice").text(payPrice);
				
				$("#count").val(plusCount);
				$("#pay").val(payPrice);
			});
			
			$(".button-plus2").on("click", function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $(".order-option-count").text();
				const shotCount = $(".order-option-shotcount").text();
				const creamCount = $(".order-option-creamcount").text();
				
				
			
			  
				//태그 안의 텍스트 값을 숫자로 변형
				const plusCount = Number(shotCount)+1;
				
				if(shotCount == 3){
					return;
				}
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = basePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = plusCount * shotPay * optionCount;
				const creamTotal = creamCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$(".order-option-shotcount").text(plusCount);
				$(".order-option-price").text(totalPrice);
				$(".order-option-totalprice").text(payPrice);
				
				$("#cupShot").val(plusCount);
				$("#pay").val(payPrice);
				
			});
			
			$(".button-plus3").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $(".order-option-count").text();
				const shotCount = $(".order-option-shotcount").text();
				const creamCount = $(".order-option-creamcount").text();
				
				const plusCount = Number(creamCount)+1;
				
				if(creamCount == 2){
					return;	
				}
			
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = basePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = shotCount * shotPay * optionCount;
				const creamTotal = plusCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$(".order-option-creamcount").text(plusCount);
				$(".order-option-price").text(totalPrice);
				$(".order-option-totalprice").text(payPrice);
					
				$("#cupCream").val(plusCount);
				$("#pay").val(payPrice);
				
			});
				
				
			$(".button-minus1").on("click",function(){
				const optionCount = $(".order-option-count").text();
				const shotCount = $(".order-option-shotcount").text();
				const creamCount = $(".order-option-creamcount").text();
				
				const minusCount = Number(optionCount)-1;
				
				if(optionCount == 1 ){
					return;
				}
				
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = basePrice * minusCount;
				const sizeTotal = sizePrice * sizeCount * minusCount;
				const shotTotal = shotCount * shotPay * minusCount;
				const creamTotal = creamCount * creamPay * minusCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				$(".order-option-count").text(minusCount);
				$(".order-base-price").text(totalPrice);
				$(".order-option-totalprice").text(payPrice);
				
				$("#count").val(minusCount);
				$("#pay").val(payPrice);
			});
					
			
			
			$(".button-minus2").on("click", function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $(".order-option-count").text();
				const shotCount = $(".order-option-shotcount").text();
				const creamCount = $(".order-option-creamcount").text();
				
				
				// 마지막 결제 금액
				//태그 안의 텍스트 값을 숫자로 변형
				const minusCount = Number(shotCount)-1;
				
				if(shotCount == 0){
					return;
				}
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
				
				const totalPrice = basePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = minusCount * shotPay * optionCount;
				const creamTotal = creamCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$(".order-option-shotcount").text(minusCount);
				$(".order-option-price").text(totalPrice);
				$(".order-option-totalprice").text(payPrice);
				
				 $("#cupShot").val(minusCount);
			     $("#pay").val(payPrice);
			});
				
				
			$(".button-minus3").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $(".order-option-count").text();
				const shotCount = $(".order-option-shotcount").text();
				const creamCount = $(".order-option-creamcount").text();
				
				const minusCount = Number(creamCount)-1;
				
				if(creamCount == 0){
					return;	
				}
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = basePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = shotCount * shotPay * optionCount;
				const creamTotal = minusCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$(".order-option-creamcount").text(minusCount);
				$(".order-option-price").text(totalPrice);
				$(".order-option-totalprice").text(payPrice);
				
				$("#cupCream").val(minusCount);
			    $("#pay").val(payPrice)
				
			});
	
	
	
	$(".order-cartadd").on("click", function(){
	    
		const productNo = $("#productNo").val();
        const productName = $("#productName").val();
        const productPrice = $("#productPrice").val();
        const shopName = $("#shopName").val();
        const count = $("#count").val();
        const cupShot = $("#cupShot").val();
        const cupCream = $("#cupCream").val();
        const cupChoice = $("#cupChoice").val();
        const cupSize = $("#cupSize").val();
        const pay = $("#pay").val();
		
	    $.ajax({
	        url: "/order/DrumtongCart",
	        type: "post",
	        data: {
	        	
	            productNo: productNo,
	            productName: productName,
	            productPrice: productPrice,
	            shopName: shopName,
	            count: count,
	            cupShot: cupShot,
	            cupCream: cupCream,
	            cupChoice: cupChoice,
	            cupSize: cupSize,
	            pay: pay
	            
	        },
	        success: function(result){
	            const check = confirm("장바구니에 담았습니다! 결제페이지로 가겠습니까?");
	          	
	            if(check) {
	            	location.href = "/order/DrumtongCart?productNo="+[[${p.productNo}]]+"&shopName="+[[${shop.shopName}]];
	            }else {
	            	location.href = "/product/productList?shopName="+[[${shop.shopName}]]+"&reqPage="+1;
	            }
	            
	        },
	        error: function(){
	            alert("로그인을 해주세요");
	            
	            location.href = "/member/loginFrm"
			
	        }
	    });
		
	    
	});	
		//로그인 체크하기
		
		
	    $(".order-moveCart").on("click",function(){
	    	const check = [[${memberNo}]];
	    	
	    	if(check == null) {
	    	alert("로그인을 해주세요");
	    		
	    	}
	    	
	    	
	    });
	
		
		
		
		
		
		
		
		
		
</script>
</body>
</html>