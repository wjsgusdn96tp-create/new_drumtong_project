<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>옵션선택</title>
    <link rel="stylesheet" href="/DrumtongCss/default.css">
    <link rel="stylesheet" href="/DrumtongCss/orderoption.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    
</head>
<body>
    <th:block th:include="/common/header"></th:block>

    
    <div class="order-option-header">옵션선택</div>

	<div class="order-option-main-box">
	    <div class="order-option-image-box"><img src="/" ></div>
	
	    <div id="drinkBox" class="order-option-option-box">
	    
	        <div class="order-option-top">
	            <div class="order-option-name" th:text="${p.productName}"></div>
	        </div>
	
	            <div class="order-option-quantity-box">
	                <div class="order-option-quantity">
	                    <button class="button-minus1"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-count">1</span>
	                    <button class="button-plus1"><span class="material-icons">add_circle_outline</span></button>
	                </div>
	                <div class="order-base-price" th:text="${p.productPrice}"></div>
	                	                <div>원</div>
	            </div>
	            
	    <div class="order-option-section">
	        <div class="order-option-label">컵 선택</div>
	            <div class="order-option-cupchoice">
	                <button class="order-option-cupbtn selected">개인</button>
	                <button class="order-option-cupbtn">매장</button>
	            </div>
	    </div>
	 
	    <div class="order-option-section">
	        <div class="order-option-label">사이즈 선택 (기본 L, XL + 2000원)</div>
	            <div class="order-option-sizechoice">
	                <button class="order-option-sizebtn selected" >L</button>
	                <button class="order-option-sizebtn" >XL</button>
	            </div>
	    </div>
	
	    <div class="order-option-section">
	        <div class="order-option-label">샷 추가 (+400원, 최대3회)</div>
	            <div class="order-option-choice">
	                <button class="button-minus2"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-shotcount">0</span>
	                <button class="button-plus2"><span class="material-icons">add_circle_outline</span></button>
	            </div>
	    </div>
	    
	    <div class="order-option-section">
	        <div class="order-option-label">휘핑크림 추가(+500원, 최대2회)</div>
	            <div class="order-option-choice">
	                <button class="button-minus3"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-creamcount" >0</span>
	                <button class="button-plus3"><span class="material-icons">add_circle_outline</span></button>
	           	</div>
	    </div>
	
	        <div class="order-option-totalbox">
	            <div class="order-option-totalname">결제금액</div>
	            <div class="order-option-totalprice" th:text="${p.productPrice}"></div>
	                <div>원</div>
	        </div>
	    </div>
	    <div id="dessertBox" class="order-option-option-box">
	    
	        <div class="order-option-top">
	            <div class="order-option-name" th:text="${p.productName}"></div>
	        </div>
	
	            <div class="order-option-quantity-box">
	                <div class="order-option-quantity">
	                    <button class="button-minus1"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-count">1</span>
	                    <button class="button-plus1"><span class="material-icons">add_circle_outline</span></button>
	                </div>
	                <div class="order-base-price" th:text="${p.productPrice}"></div>
	                	                <div>원</div>
	            </div>
	          
	   
	       
	 
	          
	
	        <div class="order-option-totalbox">
	            <div class="order-option-totalname">결제금액</div>
	            <div class="order-option-totalprice" th:text="${p.productPrice}"></div>
	                <div>원</div>
	        </div>
	    </div>
	    <div id="goodsBox" class="order-option-option-box">
	    
	        <div class="order-option-top">
	            <div class="order-option-name" th:text="${p.productName}"></div>
	        </div>
	
	            <div class="order-option-quantity-box">
	                <div class="order-option-quantity">
	                    <button class="button-minus1"><span class="material-icons">remove_circle_outline</span></button>
	                    <span class="order-option-count">1</span>
	                    <button class="button-plus1"><span class="material-icons">add_circle_outline</span></button>
	                </div>
	                <div class="order-base-price" th:text="${p.productPrice}"></div>
	                	                <div>원</div>
	            </div>
	            
	
	        <div class="order-option-totalbox">
	            <div class="order-option-totalname">결제금액</div>
	            <div class="order-option-totalprice" th:text="${p.productPrice}"></div>
	                <div>원</div>
	        </div>
	    </div>
	</div>



	<div class="order-option-footer">
	
	
	    <a th:href="@{'/product/productList?shopName='+${shop.shopName}+'&reqPage=1'}" class="order-listpage">메뉴목록</a>
	 			
	 			
	    
		
		
		      <input type="hidden" name="productNo" id="productNo" th:value="${p.productNo}">
			  <input type="hidden" name="productName" id="productName" th:value="${p.productName}">
			  <input type="hidden" name="productPrice" id="productPrice" th:value="${p.productPrice}">
			  <input type="hidden" name="shopName" id="shopName" th:value="${shop.shopName}">
			  <input type="hidden" name="productImg" id="productImg" th:value="${p.productImg}">
		      <input type="hidden" name="cupShot" id="cupShot" th:value="0">
		      <input type="hidden" name="cupCream" id="cupCream" th:value="0">
		      <input type="hidden" name="cupChoice" id="cupChoice" th:value="개인">
		      <input type="hidden" name="cupSize" id="cupSize" th:value="L">
		      <input type="hidden" name="productTitle" id="productTitle" th:value="${p.productTitle}">
		      
		      <input type="hidden" name="count" id="count" th:value="1">
		      
			  <input type="hidden" id="drinkCount" value="1">
			  <input type="hidden" id="dessertCount" value="1">
			  <input type="hidden" id="goodsCount" value="1">
		      
	   		  <input type="hidden" name="pay" id="pay" th:value="${p.productPrice}">
		      
		      <input type="hidden" name="pay" id="drinkPay" th:value="${p.productPrice}">
	   	      <input type="hidden" name="pay" id="dessertPay" th:value="${p.productPrice}">
	   	      <input type="hidden" name="pay" id="goodsPay" th:value="${p.productPrice}">		 
	   
	    
	    <button type="submit" class="order-cartadd">장바구니담기</button>

	    
	    
	    
	</div>
	<th:block th:include="common/footer"></th:block>
	<script th:inline="javascript">
			//타이틀 값 저장
			const productTitle = [[${p.productTitle}]];
			
			$("#drinkBox, #dessertBox, #goodsBox").hide();
			
			//쇼 하이드로 보이기 숨기
			if (productTitle === "drink") {
				$("#drinkBox").show();
			}else if (productTitle === "dessert") {
			    $("#dessertBox").show();
			}else if (productTitle === "goods") {
			    $("#goodsBox").show();
			}
			
			const shotPay =  400;
			const creamPay = 500;
			const sizePrice = 2000;
			let selectedSize = "L";
			
			const drinkBasePrice = Number($("#drinkBox .order-base-price").text());
			const dessertBasePrice = Number($("#dessertBox .order-base-price").text());
			const goodsBasePrice = Number($("#goodsBox .order-base-price").text());
			
			if (productTitle === "drink") {
			    $("#pay").val(drinkBasePrice);
			} else if (productTitle === "dessert") {
			    $("#pay").val(dessertBasePrice);
			} else if (productTitle === "goods") {
			    $("#pay").val(goodsBasePrice);
			}
			
			
			
			
			
			$("#dessertBox .button-plus1").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $("#dessertBox .order-option-count").text();
				
				const plusCount = Number(optionCount)+1;
				
				if(optionCount == 10){
					return;
				}
				
				
				const totalPrice = dessertBasePrice * plusCount;
				const payPrice = totalPrice;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$("#dessertBox .order-option-count").text(plusCount);
				$("#dessertBox .order-base-price").text(totalPrice);
				$("#dessertBox .order-option-totalprice").text(payPrice);
				
				$("#dessertCount").val(plusCount);
				$("#dessertPay").val(payPrice);
			});
			
			
			$("#dessertBox .button-minus1").on("click",function(){
				const optionCount = $("#dessertBox .order-option-count").text();
				
				const minusCount = Number(optionCount)-1;
				
				if(optionCount == 1 ){
					return;
				}
			
				const totalPrice = dessertBasePrice * minusCount;
				const payPrice = totalPrice;
						
				$("#dessertBox .order-option-count").text(minusCount);
				$("#dessertBox .order-base-price").text(totalPrice);
				$("#dessertBox .order-option-totalprice").text(payPrice);
				
				$("#dessertBox").val(minusCount);
				$("#dessertBox").val(payPrice);
			});
			
			
			$("#goodsBox .button-plus1").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $("#goodsBox .order-option-count").text();
				
				const plusCount = Number(optionCount)+1;
				
				if(optionCount == 10){
					return;
				}
				
				
				const totalPrice = goodsBasePrice * plusCount;
				const payPrice = totalPrice;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$("#goodsBox .order-option-count").text(plusCount);
				$("#goodsBox .order-base-price").text(totalPrice);
				$("#goodsBox .order-option-totalprice").text(payPrice);
				
				$("#goodsCount").val(plusCount);
				$("#goodsPay").val(payPrice);
			});
			
			
			$("#goodsBox .button-minus1").on("click",function(){
				const optionCount = $("#dessertBox .order-option-count").text();
				
				const minusCount = Number(optionCount)-1;
				
				if(optionCount == 1 ){
					return;
				}
			
				const totalPrice = goodsBasePrice * minusCount;
				const payPrice = totalPrice;
						
				$("#goodsBox .order-option-count").text(minusCount);
				$("#goodsBox .order-base-price").text(totalPrice);
				$("#goodsBox .order-option-totalprice").text(payPrice);
				
				$("#goodsCount").val(minusCount);
				$("#goodsPay").val(payPrice);
			});
			
			
			
			
			$("#drinkBox .order-option-sizebtn").on("click",function(){
			
				const optionCount = $("#drinkBox .order-option-count").text();
				const shotCount = $("#drinkBox .order-option-shotcount").text();
				const creamCount = $("#drinkBox .order-option-creamcount").text();
				
				const shop = $(this).text();	
				
				console.log(shop);
			
				$("#drinkBox .order-option-sizebtn").removeClass("selected");	
				$(this).addClass("selected");
				
				selectedSize = shop;
				
				let plusCount = 0;
				
				if(selectedSize=="XL") {
					plusCount = 1;
				} 
					
					
				const totalPrice = drinkBasePrice * optionCount;
				const sizeTotal = sizePrice * plusCount * optionCount;
				const shotTotal = shotCount * shotPay * optionCount;
				const creamTotal = creamCount * creamPay * optionCount;
			
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
				
					//태그 안의 문자열값에 플러스한 값을 대입
					$("#drinkBox .order-option-price").text(totalPrice);
					$("#drinkBox .order-option-totalprice").text(payPrice);
				
					
					//인풋값 밸류 변경 밸류값을 대입
			
					 $("#cupSize").val(shop);    // "L" or "XL" 값
					 $("#drinkPay").val(payPrice);    // 결제금액
			
			});
			
			$("#drinkBox .order-option-cupbtn").on("click",function(){
				const solo = $(this).text();
				
				$("#drinkBox .order-option-cupbtn").removeClass("selected");	
				
				$(this).addClass("selected");
				
				$("#cupChoice").val(solo);
			
			});
			
			//지정한 클래스명을 눌렀을때 동작		
			$("#drinkBox .button-plus1").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $("#drinkBox .order-option-count").text();
				const shotCount = $("#drinkBox .order-option-shotcount").text();
				const creamCount = $("#drinkBox .order-option-creamcount").text();
				
			
				const plusCount = Number(optionCount)+1;
				
				if(optionCount == 10){
					return;
				}
				
				let sizeCount = 0;
				
				if(selectedSize == "XL") {
					sizeCount = 1;
				}
				
				const totalPrice = drinkBasePrice * plusCount;
				const sizeTotal = sizePrice * sizeCount * plusCount;
				const shotTotal = shotCount * shotPay * plusCount;
				const creamTotal = creamCount * creamPay * plusCount;
						
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$("#drinkBox .order-option-count").text(plusCount);
				$("#drinkBox .order-base-price").text(totalPrice);
				$("#drinkBox .order-option-totalprice").text(payPrice);
				
				$("#drinkCount").val(plusCount);
				$("#drinkPay").val(payPrice);
			});
			
			$("#drinkBox .button-plus2").on("click", function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $("#drinkBox .order-option-count").text();
				const shotCount = $("#drinkBox .order-option-shotcount").text();
				const creamCount = $("#drinkBox .order-option-creamcount").text();
				
				
			
			  
				//태그 안의 텍스트 값을 숫자로 변형
				const plusCount = Number(shotCount)+1;
				
				if(shotCount == 3){
					return;
				}
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = drinkBasePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = plusCount * shotPay * optionCount;
				const creamTotal = creamCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$("#drinkBox .order-option-shotcount").text(plusCount);
				$("#drinkBox .order-option-price").text(totalPrice);
				$("#drinkBox .order-option-totalprice").text(payPrice);
				
				$("#cupShot").val(plusCount);
				$("#drinkPay").val(payPrice)
				
			});
			
			$("#drinkBox .button-plus3").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $("#drinkBox .order-option-count").text();
				const shotCount = $("#drinkBox .order-option-shotcount").text();
				const creamCount = $("#drinkBox .order-option-creamcount").text();
				
				const plusCount = Number(creamCount)+1;
				
				if(creamCount == 2){
					return;	
				}
			
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = drinkBasePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = shotCount * shotPay * optionCount;
				const creamTotal = plusCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$("#drinkBox .order-option-creamcount").text(plusCount);
				$("#drinkBox .order-option-price").text(totalPrice);
				$("#drinkBox .order-option-totalprice").text(payPrice);
					
				$("#cupCream").val(plusCount);
				$("#drinkpay").val(payPrice);
				
			});
				
				
			$("#drinkBox .button-minus1").on("click",function(){
				const optionCount = $("#drinkBox .order-option-count").text();
				const shotCount = $("#drinkBox .order-option-shotcount").text();
				const creamCount = $("#drinkBox .order-option-creamcount").text();
				
				const minusCount = Number(optionCount)-1;
				
				if(optionCount == 1 ){
					return;
				}
				
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = drinkBasePrice * minusCount;
				const sizeTotal = sizePrice * sizeCount * minusCount;
				const shotTotal = shotCount * shotPay * minusCount;
				const creamTotal = creamCount * creamPay * minusCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				$("#drinkBox .order-option-count").text(minusCount);
				$("#drinkBox .order-base-price").text(totalPrice);
				$("#drinkBox .order-option-totalprice").text(payPrice);
				
				$("#drinkCount").val(minusCount);
				$("#drinkPay").val(payPrice);
			});
					
			
			
			$("#drinkBox .button-minus2").on("click", function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $("#drinkBox .order-option-count").text();
				const shotCount = $("#drinkBox .order-option-shotcount").text();
				const creamCount = $("#drinkBox .order-option-creamcount").text();
				
				
				// 마지막 결제 금액
				//태그 안의 텍스트 값을 숫자로 변형
				const minusCount = Number(shotCount)-1;
				
				if(shotCount == 0){
					return;
				}
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
				
				const totalPrice = drinkBasePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = minusCount * shotPay * optionCount;
				const creamTotal = creamCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$("#drinkBox .order-option-shotcount").text(minusCount);
				$("#drinkBox .order-option-price").text(totalPrice);
				$("#drinkBox .order-option-totalprice").text(payPrice);
				
				 $("#cupShot").val(minusCount);
			     $("#drinkPay").val(payPrice);
			});
				
				
			$("#drinkBox .button-minus3").on("click",function(){
				//지정한 클래스명의 태그 안의 문자열값을 대입 처음 금액 
				const optionCount = $("#drinkBox .order-option-count").text();
				const shotCount = $("#drinkBox .order-option-shotcount").text();
				const creamCount = $("#drinkBox .order-option-creamcount").text();
				
				const minusCount = Number(creamCount)-1;
				
				if(creamCount == 0){
					return;	
				}
				
				let sizeCount = 0;
				if(selectedSize=="XL") {
					sizeCount = 1;
				} 
			
				const totalPrice = drinkBasePrice * optionCount;
				const sizeTotal = sizePrice * sizeCount * optionCount;
				const shotTotal = shotCount * shotPay * optionCount;
				const creamTotal = minusCount * creamPay * optionCount;
				
				const payPrice = totalPrice + sizeTotal + shotTotal + creamTotal;
						
				//태그 안의 문자열값에 플러스한 값을 대입
				$("#drinkBox .order-option-creamcount").text(minusCount);
				$("#drinkBox .order-option-price").text(totalPrice);
				$("#drinkBox .order-option-totalprice").text(payPrice);
				
				$("#cupCream").val(minusCount);
			    $("#drinkPay").val(payPrice)
				
			});
	
	
	
	$(".order-cartadd").on("click", function(){
		const productTitle = [[${p.productTitle}]];
		let count = 1;
		let pay = 0;
		
		if(productTitle === "drink"){
			count = $("#drinkCount").val();
			pay = $("#drinkPay").val();
		}else if (productTitle === "dessert") {
	        count = $("#dessertCount").val();
	        pay = $("#dessertPay").val();
		 } else if (productTitle === "goods") {
		    count = $("#goodsCount").val();
		    pay = $("#goodsPay").val();
		 }
		
		const productNo = $("#productNo").val();
        const productName = $("#productName").val();
        const productPrice = $("#productPrice").val();
        const shopName = $("#shopName").val();
        
        const cupShot = $("#cupShot").val();
        const cupCream = $("#cupCream").val();
        const cupChoice = $("#cupChoice").val();
        const cupSize = $("#cupSize").val();
		
        
        
        
	    $.ajax({
	        url: "/order/DrumtongCart",
	        type: "post",
	        data: {
	        		productTitle: productTitle,
	            productNo: productNo,
	            productName: productName,
	            productPrice: productPrice,
	            shopName: shopName,
	            count: count,
	            cupShot: cupShot,
	            cupCream: cupCream,
	            cupChoice: cupChoice,
	            cupSize: cupSize,
	            pay: pay
	            
	        },
	        success: function(result){
	            const check = confirm("장바구니에 담았습니다! 결제페이지로 가겠습니까?");
	          	
	            if(check) {
	            	location.href = "/order/DrumtongCart?productNo="+[[${p.productNo}]]+"&shopName="+[[${shop.shopName}]];
	            }else {
	            	location.href = "/product/productList?shopName="+[[${shop.shopName}]]+"&reqPage="+1;
	            }
	            
	        },
	        error: function(){
	            alert("로그인을 해주세요");
	            
	            location.href = "/member/loginFrm"
			
	        }
	    });
		
	    
	});	
		//로그인 체크하기
		
		
	    $(".order-moveCart").on("click",function(){
	    	const check = [[${memberNo}]];
	    	
	    	if(check == null) {
	    	alert("로그인을 해주세요");
	    		
	    	}
	    	
	    	
	    });
	
		
		
		
		
		
		
		
		
		
</script>
</body>
</html>